<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Evento</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header-component></header-component>
    <div class="event-details">
        <h1 id="eventTitle">Carregando...</h1>
        <div id="eventInfo" class="event-info">
            <!-- Event details will be loaded here -->
        </div>
        <div class="bet-section">
            <h2>Faça sua Aposta</h2>
            <input type="number" id="betAmount" placeholder="Valor da Aposta" min="0">
            <button id="placeBetButton">Apostar</button>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');

        async function fetchEventDetails() {
            try {
                const response = await fetch('/getEventsList');
                const events = await response.json();
                console.log('Event ID from URL:', eventId, 'Type:', typeof eventId);
                console.log('Available events:', events);
                const eventDetails = events.find(event => event.id === parseInt(eventId));
                console.log('Found event:', eventDetails);
                if (!eventDetails) throw new Error('Evento não encontrado');
                displayEventDetails(eventDetails);
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('eventInfo').innerHTML = '<div class="error">Erro ao carregar detalhes do evento. Tente novamente mais tarde.</div>';
            }
        }

        function displayEventDetails(event) {
            document.getElementById('eventTitle').textContent = event.title;
            document.getElementById('eventInfo').innerHTML = `
                <p>${event.description || 'Sem descrição'}</p>
                <p>Organizador: ${event.organizer || 'Não especificado'}</p>
                <p>Valor da Cota: R$ ${event.quotavalue?.toFixed(2) || '0.00'}</p>
                <p>Status: ${getStatusText(event.approval_status)}</p>
                <p>Prazo para Apostas: ${formatDate(event.betting_end_time)}</p>
                <p>Última atualização: ${formatDate(event.updated_at)}</p>
            `;
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch {
                return 'Data não disponível';
            }
        }

        function getStatusText(status) {
            const statusMap = {
                1: 'Pendente',
                2: 'Aprovado',
                3: 'Negado',
                4: 'Finalizado'
            };
            return statusMap[status] || 'Desconhecido';
        }

        function updateTotalValue(quotaValue) {
            const quotas = parseInt(document.getElementById('quotaAmount').value) || 0;
            const total = quotas * quotaValue;
            document.getElementById('totalValue').textContent = `Total: R$ ${total.toFixed(2)}`;
        }

        document.getElementById('placeBetButton').addEventListener('click', () => {
            const quotas = parseInt(document.getElementById('quotaAmount').value) || 0;
            const quotaValue = parseFloat(document.getElementById('eventInfo').querySelector('p:nth-child(3)').textContent.split('R$')[1]);
            const total = quotas * quotaValue;
            
            if (quotas <= 0) {
                alert('Por favor, insira uma quantidade válida de cotas.');
                return;
            }

            // Verifica se o valor total é múltiplo do valor da cota
            if (total % quotaValue !== 0) {
                alert(`O valor da aposta deve ser um múltiplo de R$ ${quotaValue.toFixed(2)}`);
                return;
            }

            alert(`Aposta de ${quotas} cota(s) (R$ ${total.toFixed(2)}) colocada com sucesso!`);
        });

        // Initial load
        fetchEventDetails();
    </script>
</body>
</html> 